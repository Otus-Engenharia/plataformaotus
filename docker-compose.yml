# =============================================================================
# docker-compose – Plataforma Otus (Relatórios)
# =============================================================================
# Projeto Docker separado. Não altera o projeto "automacoes" (n8n, waha, nginx).
# Porta 3001: só esta aplicação. Os outros continuam em 5678, 3000, 80/443.
# =============================================================================

services:
  plataformaotus:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VITE_API_URL: ""   # mesmo domínio em produção
    container_name: plataformaotus-app
    restart: unless-stopped
    ports:
      - "0.0.0.0:3001:3001"
    env_file:
      - ./backend/.env
    environment:
      - NODE_ENV=production
      - PORT=3001
      - HOST=0.0.0.0
    volumes:
      # Credenciais do Google Cloud (manter fora da imagem)
      - ./backend/service-account-key.json:/app/service-account-key.json:ro
    # Limites para não consumir recursos dos outros projetos
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M
        reservations:
          cpus: "0.2"
          memory: 256M
